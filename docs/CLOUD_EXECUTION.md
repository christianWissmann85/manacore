# Cloud Execution Guide

This guide explains how to run ManaCore experiments on a cloud server using Docker. This is recommended for long-running experiments like the MCTS tuning pipeline.

## Prerequisites

- A cloud server (VPS/VM) running Linux (e.g., Ubuntu 22.04 or 24.04).
- `git` and `docker` installed on the server.
- Access to this repository.

## 1. Server Setup (Ubuntu Example)

Connect to your server and install Docker:

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Add your user to the docker group (avoids needing sudo for docker commands)
sudo usermod -aG docker $USER
newgrp docker

# Verify installation
docker --version
```

## 2. Deploying the Code

Clone the repository to your server:

```bash
git clone https://github.com/your-username/manacore.git
cd manacore
```

*(Note: If the repo is private, you'll need to use an SSH key or a Personal Access Token).*

## 3. Running Experiments

We provide a helper script `scripts/docker-run.sh` that builds the Docker image and runs an experiment.

### Basic Usage

Run the default pipeline experiment (`experiments/mcts-greedy-tuning-pipeline.json`):

```bash
./scripts/docker-run.sh
```

### Running a Specific Experiment

Pass the path to the experiment JSON file:

```bash
./scripts/docker-run.sh experiments/tune-mcts-grid.json
```

## 4. Retrieving Results

The script mounts the local `output/` directory to the container. Any results generated by the experiment will appear in `output/` on your host server.

To copy results back to your local machine, you can use `scp`:

```bash
# Run this from your LOCAL machine
scp -r user@your-server-ip:~/manacore/output/pipeline ./local-results/
```

## 5. Running in Background (Detached)

For very long experiments, you might want to run the container in the background so it persists even if you disconnect.

You can modify the `docker run` command in `scripts/docker-run.sh` to include `-d` (detached), or simply run it directly:

```bash
# Build the image first
docker build -t manacore .

# Run in background with a name
docker run -d --name tuning-run \
  -v "$(pwd)/output:/app/output" \
  -v "$(pwd)/experiments:/app/experiments" \
  manacore run experiments/mcts-greedy-tuning-pipeline.json

# View logs
docker logs -f tuning-run
```

## Troubleshooting

- **Performance**: Ensure your cloud instance has enough CPU and RAM. The tuning pipeline is CPU-intensive.
- **Permissions**: If you see permission errors in `output/`, ensure the container has write access. The Dockerfile runs as root by default, so files created in `output/` will be owned by root. You may need to run `sudo chown -R $USER:$USER output/` after the run.
